<!-- Dependencies -->
<link rel="import" href="../polymer/polymer/polymer.html">
<link rel="import" href="expandable-card.html">

<dom-module id="talk-list">

<!-- DOM + styling -->
<template>
    <!-- Element styling -->
    <style>
        :host {
            display: flex;
            flex-flow: column;
        }

        @media (min-width: 750px) {
            :host {
                flex-flow: row wrap;
                align-items: stretch;
            }
        }

    </style>

    <!-- Element DOM -->
    <template is="dom-repeat" items="{{talks}}">
        <expandable-card doc="{{item}}">
            <div class="card-title">{{item.title}}</div>
            <div class="card-description">{{item.description}}</div>
        </expandable-card>
    </template>
</template>

<!-- Element declaration + script -->
<script>
    Polymer({
        is: 'talk-list',
        properties: {
            src: String,
            talks: {
                type: Array,
                value: function() { return []; },
                notify: true
            }
        },

        factoryImpl: function(src) {
            this.src = src;
        },

        ready: function() {
            fetch(this.src)
            .then(response => {
                response.json()
                .then(json => {
                    var talk_data = json.rows;
                    talk_data.forEach((element, index, array) => {
                        talk_data[index] = element.doc;
                    });
                    this.talks = talk_data;
                })
            });
        },

        addTalkLocal: function(talk) {
            console.log(talk);
            this.talks.push(talk);
            this.talks = this.talks.slice(0);
        }
    });
</script>
</dom-module>
